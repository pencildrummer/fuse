(function(a,p){typeof exports=="object"&&typeof module!="undefined"?p(exports,require("@fuse-labs/core-client"),require("@fuse-labs/core-ui"),require("@radix-ui/react-icons"),require("is-electron"),require("react")):typeof define=="function"&&define.amd?define(["exports","@fuse-labs/core-client","@fuse-labs/core-ui","@radix-ui/react-icons","is-electron","react"],p):(a=typeof globalThis!="undefined"?globalThis:a||self,p(a["@fuse-labs/marlin-core"]={},a.coreClient,a.coreUi,a.reactIcons,a.isElectron,a.React))})(this,function(a,p,c,b,S,g){"use strict";function _(e){return e&&typeof e=="object"&&"default"in e?e:{default:e}}var E=_(S),k=_(g),y={exports:{}},x={};/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var O=Object.getOwnPropertySymbols,q=Object.prototype.hasOwnProperty,C=Object.prototype.propertyIsEnumerable;function I(e){if(e==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}function J(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de",Object.getOwnPropertyNames(e)[0]==="5")return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;var s=Object.getOwnPropertyNames(t).map(function(i){return t[i]});if(s.join("")!=="0123456789")return!1;var o={};return"abcdefghijklmnopqrst".split("").forEach(function(i){o[i]=i}),Object.keys(Object.assign({},o)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}J();/** @license React v17.0.2
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var R=k.default,j=60103;if(x.Fragment=60107,typeof Symbol=="function"&&Symbol.for){var w=Symbol.for;j=w("react.element"),x.Fragment=w("react.fragment")}var T=R.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,L=Object.prototype.hasOwnProperty,B={key:!0,ref:!0,__self:!0,__source:!0};function N(e,t,n){var s,o={},i=null,l=null;n!==void 0&&(i=""+n),t.key!==void 0&&(i=""+t.key),t.ref!==void 0&&(l=t.ref);for(s in t)L.call(t,s)&&!B.hasOwnProperty(s)&&(o[s]=t[s]);if(e&&e.defaultProps)for(s in t=e.defaultProps,t)o[s]===void 0&&(o[s]=t[s]);return{$$typeof:j,type:e,key:i,ref:l,props:o,_owner:T.current}}x.jsx=N,x.jsxs=N,y.exports=x;const r=y.exports.jsx,m=y.exports.jsxs;function D(){const{device:e}=p.useDeviceContext(),{addStatus:t,removeStatus:n}=c.useDeviceStatusListContext(),[s,o]=g.useState([]);return g.useEffect(i=>{const l=u=>{o(h=>[...h,u])},d=u=>{o(h=>{let f=[...h],v=f.findIndex(z=>z.id===u.id);return v>-1?f.splice(v,1,u):console.warn("Received progress update for a job not in the queue"),f})},P=u=>{o(f=>f.filter(v=>v.id!==u.id));let h=t(`Finished job ${u.name}`,{type:"success"});if(setTimeout(f=>n(h.id),1500),E.default()){let f=new Notification(e.name,{body:`${u.name} has been completed`});f.onclick=v=>console.log("Clicked notification")}};return e.socket.on("job:added",l),e.socket.on("job:progress",d),e.socket.on("job:finish",P),u=>{e.socket.off("job:added",l),e.socket.off("job:progress",d),e.socket.off("job:finish",P)}},[e]),m(c.Popover,{children:[r(c.Popover.Trigger,{children:r(c.Button,{size:"sm",mode:"ghost",squared:!0,children:r(b.LayersIcon,{})})}),r(c.Popover.Content,{align:"end",children:r(F,{jobs:s})})]})}function F({jobs:e}){return m("ul",{className:"p-1 divide-y divide-gray-600",children:[r("li",{className:"leading-none flex items-center pb-1.5",children:r("span",{className:"font-syncopate text-xxs leading-none uppercase",children:"Jobs"})}),e!=null&&e.length?e==null?void 0:e.map(t=>r(A,{job:t},`job-${t.id}`)):r("li",{className:"pt-5 pb-4 text-xs text-gray-500",children:r(c.EmptyView,{text:"No jobs in the queue"})})]})}function A({job:e}){var t,n;return m("li",{className:"flex flex-col max-w-[200px] pb-2 last:pb-0",children:[m("div",{className:"flex flex-row h-10 items-center space-x-2",children:[m("div",{className:"flex-1 flex flex-col truncate",children:[r("div",{className:"text-xs truncate font-semibold",children:e.name}),r("div",{className:"flex flex-row justify-between",children:r("div",{className:"text-xxs text-gray-500",children:e.startedAt?r("span",{children:e.startedAt}):r("span",{children:"Pending..."})})})]}),m("div",{className:"flex flex-row items-center",children:[r(c.Button,{size:"sm",mode:"ghost",rounded:!0,squared:!0,className:"text-amber-500",children:r(b.PauseIcon,{})}),r(c.Button,{size:"sm",mode:"ghost",rounded:!0,squared:!0,className:"text-red-400",children:r(b.StopIcon,{})})]})]}),r(c.Progress,{value:((t=e.progress)==null?void 0:t.current)||0,max:((n=e.progress)==null?void 0:n.total)||100})]})}class M extends p.ClientPlugin{deviceComponents(t){return{page:{topBar:D}}}}a.default=M,Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
